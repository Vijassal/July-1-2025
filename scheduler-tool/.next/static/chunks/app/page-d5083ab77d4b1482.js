(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1536:function(e,t,r){Promise.resolve().then(r.bind(r,8672))},8672:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return SchedulerPage}});var s=r(7437),n=r(2265),a=r(4033),l=r(3868),o=r(2601);let i=o.env.NEXT_PUBLIC_API_BASE_URL||"https://api.mycompany.com";async function submitBooking(e){try{let t=await fetch("".concat(i,"/api/scheduler/book"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){return console.error("Error submitting booking:",e),{success:!1,error:"Failed to submit booking"}}}async function getBookingLinkDetails(e){try{let t=await fetch("".concat(i,"/api/scheduler/link/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){return console.error("Error fetching booking link details:",e),null}}async function validateBookingLink(e){try{let t=await getBookingLinkDetails(e);return t&&t.success}catch(e){return!1}}var c=r(7496),d=r(1257),u=r(4800),m=r(49),h=r(4238),x=r(9956),g=r(3008),b=r(7972),p=r(1295),f=r(2741),y=r(6637);function BookingForm(e){let{linkToken:t,eventId:r}=e,[a,l]=(0,n.useState)("date"),[o,i]=(0,n.useState)(null),[v,j]=(0,n.useState)(""),[N,k]=(0,n.useState)(!1),[w,S]=(0,n.useState)(""),[_,T]=(0,n.useState)({vendor_name:"",vendor_email:"",vendor_phone:"",service_type:"",service_description:""}),M=new Date,P=(0,u.Z)(M),E=(0,m.Z)((0,d.Z)(M,28)),C=(0,h.Z)({start:P,end:E}),handleDateSelect=e=>{i(e),l("time")},handleTimeSelect=e=>{j(e),l("details")},handleFormSubmit=async e=>{e.preventDefault(),k(!0);try{let e={..._,proposed_date:o?(0,c.Z)(o,"yyyy-MM-dd"):"",proposed_time:v,event_id:r,booking_link_id:t},s=await submitBooking(e);s.success?(S(s.booking_id||""),l("confirmation")):alert(s.error||"Booking failed. Please try again.")}catch(e){console.error("Booking error:",e),alert("An error occurred. Please try again.")}finally{k(!1)}};return"confirmation"===a?(0,s.jsx)("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(g.Z,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Your booking has been successfully submitted. We'll get back to you soon."}),w&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 mb-6",children:["Booking ID: ",(0,s.jsx)("span",{className:"font-mono",children:w})]}),(0,s.jsx)("button",{onClick:()=>{l("date"),i(null),j(""),T({vendor_name:"",vendor_email:"",vendor_phone:"",service_type:"",service_description:""})},className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Book Another Appointment"})]})}):(0,s.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Schedule Your Appointment"}),(0,s.jsx)("p",{className:"text-blue-100 mt-1",children:"Choose a date and time that works for you"})]}),(0,s.jsx)("div",{className:"flex items-center justify-center p-4 bg-gray-50",children:(0,s.jsx)("div",{className:"flex items-center space-x-4",children:["date","time","details"].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(a===e?"bg-blue-600 text-white":"details"===a&&t<2?"bg-green-500 text-white":"bg-gray-300 text-gray-600"),children:t+1}),t<2&&(0,s.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat("details"===a?"bg-green-500":"bg-gray-300")})]},e))})}),(0,s.jsxs)("div",{className:"p-6",children:["date"===a&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Select a Date"}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,s.jsx)("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:e},e)),C.map(e=>{let t=(0,x.Z)(e,M),r=e<M,n=o&&(0,x.Z)(e,o);return(0,s.jsx)("button",{onClick:()=>!r&&handleDateSelect(e),disabled:r,className:"\n                      p-3 rounded-lg text-sm font-medium transition-colors\n                      ".concat(r?"text-gray-300 cursor-not-allowed":n?"bg-blue-600 text-white":t?"bg-blue-100 text-blue-600 hover:bg-blue-200":"text-gray-700 hover:bg-gray-100","\n                    "),children:(0,c.Z)(e,"d")},e.toISOString())})]})]}),"time"===a&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Select a Time for ",o&&(0,c.Z)(o,"EEEE, MMMM d")]}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-3",children:["09:00 AM","09:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","01:00 PM","01:30 PM","02:00 PM","02:30 PM","03:00 PM","03:30 PM","04:00 PM","04:30 PM","05:00 PM","05:30 PM","06:00 PM","06:30 PM"].map(e=>(0,s.jsx)("button",{onClick:()=>handleTimeSelect(e),className:"p-3 border border-gray-200 rounded-lg text-sm font-medium hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e},e))}),(0,s.jsx)("button",{onClick:()=>l("date"),className:"mt-4 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"← Back to date selection"})]}),"details"===a&&(0,s.jsxs)("form",{onSubmit:handleFormSubmit,className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Your Details"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,s.jsx)(b.Z,{className:"w-4 h-4 inline mr-2"}),"Full Name *"]}),(0,s.jsx)("input",{type:"text",required:!0,value:_.vendor_name,onChange:e=>T({..._,vendor_name:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your full name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,s.jsx)(p.Z,{className:"w-4 h-4 inline mr-2"}),"Email Address *"]}),(0,s.jsx)("input",{type:"email",required:!0,value:_.vendor_email,onChange:e=>T({..._,vendor_email:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,s.jsx)(f.Z,{className:"w-4 h-4 inline mr-2"}),"Phone Number"]}),(0,s.jsx)("input",{type:"tel",value:_.vendor_phone,onChange:e=>T({..._,vendor_phone:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your phone number"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Type *"}),(0,s.jsxs)("select",{required:!0,value:_.service_type,onChange:e=>T({..._,service_type:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"",children:"Select a service type"}),(0,s.jsx)("option",{value:"catering",children:"Catering"}),(0,s.jsx)("option",{value:"photography",children:"Photography"}),(0,s.jsx)("option",{value:"music",children:"Music/Entertainment"}),(0,s.jsx)("option",{value:"decor",children:"Decorations"}),(0,s.jsx)("option",{value:"transportation",children:"Transportation"}),(0,s.jsx)("option",{value:"other",children:"Other"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,s.jsx)(y.Z,{className:"w-4 h-4 inline mr-2"}),"Additional Details"]}),(0,s.jsx)("textarea",{value:_.service_description,onChange:e=>T({..._,service_description:e.target.value}),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Tell us more about your requirements..."})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Booking Summary"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Date:"})," ",o&&(0,c.Z)(o,"EEEE, MMMM d, yyyy")]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Time:"})," ",v]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Service:"})," ",_.service_type||"Not selected"]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>l("time"),className:"flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"← Back"}),(0,s.jsx)("button",{type:"submit",disabled:N,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N?"Submitting...":"Confirm Booking"})]})]})]})]})}var v=r(5589),j=r(2894);function Unauthorized(){return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:(0,s.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(v.Z,{className:"w-8 h-8 text-red-600"})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,s.jsx)("p",{className:"text-gray-600",children:"You need a valid invitation link to access this scheduling tool."})]}),(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)(j.Z,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Invalid or Missing Token"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"This scheduling tool requires a valid JWT token to access. Please use the link provided in your invitation email."})]})]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"If you believe this is an error, please contact the event organizer."}),(0,s.jsx)("button",{onClick:()=>window.close(),className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Close Window"})]}),(0,s.jsx)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Scheduler Tool v1.0 • Secure Booking System"})})]})})}function SchedulerPage(){let[e,t]=(0,n.useState)(!0),[r,o]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),x=(0,a.useSearchParams)();return((0,n.useEffect)(()=>{let initializeAuth=async()=>{try{let e=(0,l.$8)();o(e);let t=(0,l.LP)();if(t){u(t);let e=await validateBookingLink(t);c(e)}let r=x.get("event_id");r&&h(r)}catch(e){console.error("Auth initialization error:",e),o(!1),c(!1)}finally{t(!1)}};initializeAuth()},[x]),e)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading scheduler..."})]})}):r&&i?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,s.jsx)(BookingForm,{linkToken:d,eventId:m})})}):(0,s.jsx)(Unauthorized,{})}},3868:function(e,t,r){"use strict";function isAuthenticated(){let e=getToken();if(!e)return!1;try{let t=parseJWT(e),r=Math.floor(Date.now()/1e3);if(t.exp<r)return removeToken(),!1;return!0}catch(e){return console.error("Token validation error:",e),removeToken(),!1}}function getToken(){let e=localStorage.getItem("scheduler_token");if(e)return e;let t=new URLSearchParams(window.location.search),r=t.get("token");return r?(localStorage.setItem("scheduler_token",r),r):null}function removeToken(){localStorage.removeItem("scheduler_token")}function parseJWT(e){try{let t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(s)}catch(e){throw Error("Invalid JWT token")}}function getUserInfo(){let e=getToken();if(!e)return null;try{return parseJWT(e)}catch(e){return null}}r.d(t,{$8:function(){return isAuthenticated},LP:function(){return getToken},bG:function(){return getUserInfo}})}},function(e){e.O(0,[531,971,472,744],function(){return e(e.s=1536)}),_N_E=e.O()}]);